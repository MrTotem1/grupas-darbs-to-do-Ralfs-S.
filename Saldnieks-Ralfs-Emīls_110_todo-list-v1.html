<!DOCTYPE html>
<!--Ralfs Saldnieks v1-->
<!--Roberts Onzuls v2-->
<html>
    <head>
        <meta charset="UTF-8" />
        <!-- Bootstrap 5 -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    </head>
    <body onload="loadData()">
        <div class="container card mt-3 p-3">
            <h3 class="text-center">Mani darbi V2</h3>

            <div class="input-group mb-3">
                <select name="priority" id="abc" class="form-select">
                    <option value="default">Izvēlieties prioritāti</option>
                    <option value="Svarīgs">Svarīgs</option>
                    <option value="Vidēja">Vidēja</option>
                    <option value="Zema">Zema</option>
                </select>
                <input class="form-control" type="text" id="text" placeholder="Ieraksti darbu...">
                <button onclick="addElement()" class="btn btn-primary" type="button">Pievienot</button>
            </div>
            <div class="input-group mb-3">
                <input class="form-control" type="text" placeholder="Meklēt uzdevumu...">
                <span class="btn-group ">
                    <button class="btn btn-secondary">Visi</button>
                    <button class="btn btn-secondary">Aktīvie</button>
                    <button class="btn btn-secondary">Pabeigtie</button>
                </span>
            </div>

            <ul id="task-list" class="list-group"></ul>
            
            <div>
                <span id="to-do"></span>
            </div>
        </div>

        <script>
            function saveData() {
                const tasks = [];
                document.querySelectorAll("#task-list li").forEach(li => {
                    tasks.push({
                        text: li.querySelector(".task-text").textContent,
                        priority: li.dataset.priority,
                        done: li.querySelector(".task-text")
                            .classList.contains("text-decoration-line-through")
                    });
                });
            
                localStorage.setItem("tasks", JSON.stringify(tasks));
            }


            function loadData() {
                const data = JSON.parse(localStorage.getItem("tasks")) || [];
                data.forEach(task => createTask(task.text, task.priority, task.done));
            }


            function createTask(text, priority = "Zema", done = false) {
                const node = document.createElement("li");
                node.className = "list-group-item d-flex align-items-center justify-content-between";
                node.dataset.priority = priority;
            
                const left = document.createElement("div");
                left.className = "d-flex align-items-center gap-2";
            
                const badge = document.createElement("span");
                badge.className = "badge";
            
                if (priority === "Svarīgs") badge.classList.add("bg-danger");
                if (priority === "Vidēja") badge.classList.add("bg-warning", "text-dark");
                if (priority === "Zema") badge.classList.add("bg-success");
            
                badge.textContent = priority.toUpperCase();
            
                const textSpan = document.createElement("span");
                textSpan.textContent = text;
                textSpan.className = "task-text";
            
                left.appendChild(badge);
                left.appendChild(textSpan);
            
                if (done) {
                    textSpan.classList.add("text-decoration-line-through");
                }
            
                node.onclick = function () {
                    textSpan.classList.toggle("text-decoration-line-through");
                    saveData();
                };
            
                const deleteButton = document.createElement("button");
                deleteButton.textContent = "Dzēst";
                deleteButton.className = "btn btn-danger btn-sm";
                deleteButton.onclick = function (e) {
                    e.stopPropagation();
                    node.remove();
                    saveData();
                };
            
                node.appendChild(left);
                node.appendChild(deleteButton);
                document.getElementById("task-list").appendChild(node);
            }


            function addElement() {
                const text = document.getElementById("text").value;
                const priority = document.getElementById("abc").value;
            
                if (text === "" || priority === "default") return;
            
                document.getElementById("text").value = "";
                document.getElementById("abc").value = "default";
            
                createTask(text, priority);
                saveData();
            }
            
            function checkAmountOfDone() {
                var tasks_done = 0;
                var text = document.getElementById("to-do");
                var tasklist = document.getElementById("task-list");
            
                document.getElementById("to-do").textContent = tasks_done;
            }
            checkAmountOfDone();
        </script>
    </body>
</html>
